@{
    Layout = "~/Views/Layouts/_DashboardLayout.cshtml";
    ViewData["Title"] = "Branches";
    @model List<HRMS.Models.Branch>
}

<div class="position-fixed top-0 end-0 p-3" style="z-index: 1100;">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Branch created successfully!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                aria-label="Close"></button>
        </div>
    </div>
</div>

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-12 d-flex justify-content-end">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                    <li class="breadcrumb-item active">Branches</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card shadow">
                    <div class="card-body">
                        <nav>
                            <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                                <button class="nav-link active" id="branches-tab" data-bs-toggle="tab"
                                    data-bs-target="#branches" type="button" role="tab" aria-controls="branches"
                                    aria-selected="true">Branches</button>
                                <button class="nav-link" id="create-branch" data-bs-toggle="tab"
                                    data-bs-target="#createBranch" type="button" role="tab" aria-controls="createBranch"
                                    aria-selected="false">Create
                                    Branch</button>
                            </div>
                        </nav>

                        <div class="tab-content p-3 border bg-light" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="branches" role="tabpanel"
                                aria-labelledby="branches-tab">
                                <div class="table-responsive">

                                    <table class="table table-bordered table-hover" id="branch_table">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Branch Name</th>
                                                <th>Email Address</th>
                                                <th>Contact No</th>
                                                <th>Landline No</th>
                                                <th>Labour No</th>
                                                <th>Manager</th>
                                                <th>Manager Contact No</th>
                                                <th>Asst Manager</th>
                                                <th>Area Manager</th>
                                                <th>No of Employees</th>
                                                <th>Options</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model != null && Model.Any())
                                            {
                                                int serial = 1;
                                                foreach (var branch in Model)
                                                {
                                                    <tr>
                                                        <td>@serial</td>
                                                        <td>@branch.BranchName</td>
                                                        <td>@branch.BranchEmailAddress</td>
                                                        <td>@branch.ContactNo</td>
                                                        <td>@branch.LandlineNo</td>
                                                        <td>@branch.BranchLabourFileno</td>
                                                        <td>@branch.BranchManager</td>
                                                        <td></td>
                                                        <td>@branch.BranchAssistantManager</td>
                                                        <td>@branch.BranchAreaManager</td>
                                                        <td></td>
                                                        <td>
                                                            <a href="@Url.Action("Edit", "Branches", new { id = branch.BranchId })"
                                                                class="btn btn-sm btn-primary">Edit</a>
                                                            <a href="@Url.Action("Delete", "Branches", new { id = branch.BranchId })"
                                                                class="btn btn-sm btn-danger">Delete</a>
                                                        </td>
                                                    </tr>
                                                    serial++;
                                                }
                                            }
                                            else
                                            {
                                                <tr>
                                                    <td colspan="12" class="text-center">No branches found.</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="createBranch" role="tabpanel"
                                aria-labelledby="create-branch">
                                <div class="card">
                                    <div class="card-body">
                                        <form action="/Branches/Create" method="POST" class="validate">
                                            <div class="row">
                                                <!-- Left Column -->
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-3">Branch Name <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="name"
                                                                id="name" required />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Email Address <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <input type="email" class="form-control" name="email"
                                                                id="email" required />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Contact No <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="contactno"
                                                                required />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Landline No</label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="landlineno" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Fax No</label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="faxno" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Emirates <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <select id="emirates" name="emirates" class="form-control"
                                                                required>
                                                                <option value="">Select Emirate</option>
                                                                <option value="Abu Dhabi">Abu Dhabi</option>
                                                                <option value="Ajman">Ajman</option>
                                                                <option value="Dubai">Dubai</option>
                                                                <option value="Fujairah">Fujairah</option>
                                                                <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                                                                <option value="Sharjah">Sharjah</option>
                                                                <option value="Umm Al Quwain">Umm Al Quwain</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Address <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <textarea class="form-control" name="address"
                                                                required></textarea>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Right Column -->
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">City Code <span
                                                                class="text-danger">*</span></label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="citycode"
                                                                required />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Postal Code</label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control" name="postalcode" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Labour File
                                                            No</label>
                                                        <div class="col-sm-9">
                                                            <input type="text" class="form-control"
                                                                name="labourfileno" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Area Manager</label>
                                                        <div class="col-sm-9">
                                                            <select name="area_manager" class="form-control">
                                                                <option value="">--Select Area Manager--</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Manager Name</label>
                                                        <div class="col-sm-9">
                                                            <select name="branch_manager" class="form-control">
                                                                <option value="">--Select Branch Manager--</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group mb-3">
                                                        <label class="col-sm-3 control-label mb-2">Asst Manager
                                                            Name</label>
                                                        <div class="col-sm-9">
                                                            <select name="asst_manager" class="form-control">
                                                                <option value="">--Select Asst Manager--</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Submit Button -->
                                            <div class="form-group">
                                                <div class="col-sm-offset-3 col-sm-9">
                                                    <button type="submit" class="btn btn-info" id="create_branch">Add
                                                        Branches</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".validate").validate({
                rules: {
                    name: {
                        required: true,
                        minlength: 2
                    },
                    email: {
                        required: true,
                        email: true
                    },
                    contactno: {
                        required: true,
                        digits: true,
                        minlength: 7,
                        maxlength: 15
                    },
                    landlineno: {
                        digits: true
                    },
                    faxno: {
                        digits: true
                    },
                    emirates: {
                        required: true
                    },
                    address: {
                        required: true,
                        minlength: 5
                    },
                    citycode: {
                        required: true
                    },
                    postalcode: {
                        digits: true
                    },
                    labourfileno: {
                        digits: true
                    }
                },
                messages: {
                    name: "Please enter the branch name",
                    emailid: "Please enter a valid email address",
                    contactno: "Enter a valid contact number",
                    emirates: "Please select an emirate",
                    address: "Address is required",
                    citycode: "City code is required",
                    postalcode: "Only digits allowed",
                    landlineno: "Only digits allowed",
                    faxno: "Only digits allowed"
                },
                errorClass: "text-danger",
                errorElement: "div",
                highlight: function (element) {
                    $(element).addClass("is-invalid");
                },
                unhighlight: function (element) {
                    $(element).removeClass("is-invalid");
                },
                submitHandler: function (form) {
                    form.submit();
                    var toastEl = document.getElementById('successToast');
                    var toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                    toast.show();
                }
            });
        });

        new DataTable('#branch_table');
    </script>
}
